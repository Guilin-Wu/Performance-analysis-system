<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>学生成绩分析系统</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts-datatool/2.0.1/dataTool.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <div class="app-container">
        <nav class="sidebar">
            <div class="sidebar-header">
                <h2>成绩分析系统</h2>
            </div>

            <ul>
                <li class="config-section" id="class-filter-container" style="display: none;">
                    <h4>班级筛选</h4>
                    <select id="class-filter" class="sidebar-select"></select>
                </li>
                <hr id="class-filter-hr" style="display: none;">

                <li class="config-section">
                    <h4>考试配置</h4>
                    <button id="config-subjects-btn" class="sidebar-button">
                        ⚙️ 配置各科满分
                    </button>
                </li>
                <hr>

                <li><a href="#" class="nav-link active" data-module="dashboard">📈 班级整体分析</a></li>
                <li><a href="#" class="nav-link" data-module="student">👩‍🎓 学生个体报告</a></li>
                <li><a href="#" class="nav-link" data-module="paper">📝 试卷科目分析</a></li>
                <li><a href="#" class="nav-link" data-module="single-subject">🎯 单科成绩分析</a></li>
                <li><a href="#" class="nav-link" data-module="boundary">📊 临界生分析</a></li>
                <li><a href="#" class="nav-link" data-module="holistic">⚖️ 全科均衡分析</a></li>
                <li><a href="#" class="nav-link" data-module="trend-distribution">🌊 成绩分布变动</a></li>
                <li><a href="#" class="nav-link" data-module="groups">🎯 学生分层筛选</a></li>
                <li><a href="#" class="nav-link" data-module="correlation">🌡️ 学科关联矩阵</a></li>
                <li><a href="#" class="nav-link" data-module="weakness">📉 偏科诊断分析</a></li>
                <li><a href="#" class="nav-link" data-module="trend">🚀 成绩趋势对比</a></li>
                <li><a href="#" class="nav-link" data-module="multi-exam">📈 多次考试分析</a></li>
                <li><a href="#" class="nav-link" data-module="item-analysis">🔬 学科小题分析</a></li>

                <hr style="margin-top: 20px; border-color: var(--border-color);">

                <li>
                    <label id="import-main-btn" class="upload-label">
                        📊 导入本次成绩
                    </label>
                    <input type="file" id="file-uploader" accept=".xlsx, .xls, .csv" style="display: none;">
                </li>
                <li>
                    <label id="import-compare-btn" class="upload-label">
                        📉 导入对比成绩
                    </label>
                    <input type="file" id="file-uploader-compare" accept=".xlsx, .xls, .csv" style="display: none;">
                </li>

                <li>
                    <button id="clear-all-data-btn" class="sidebar-button"
                        style="width: 100%; background-color: var(--color-red); margin-top: 10px;">
                        🗑️ 清除所有导入数据
                    </button>
                </li>
                <li><a href="#" class="nav-link">✍️ 作者：G.L.Wu</a></li>
            </ul>
        </nav>

        <main class="main-content">
            <div id="welcome-screen">
                <h2>欢迎使用成绩分析系统</h2>
                <p>请点击左侧 "📊 导入本次成绩" 开始分析。</p>
            </div>

            <div id="module-dashboard" class="module-panel"></div>
            <div id="module-student" class="module-panel"></div>
            <div id="module-paper" class="module-panel"></div>
            <div id="module-single-subject" class="module-panel"></div>
            <div id="module-boundary" class="module-panel"></div>
            <div id="module-holistic" class="module-panel"></div>
            <div id="module-trend-distribution" class="module-panel"></div>
            <div id="module-groups" class="module-panel"></div>
            <div id="module-correlation" class="module-panel"></div>
            <div id="module-weakness" class="module-panel"></div>
            <div id="module-trend" class="module-panel"></div>
            <div id="module-multi-exam" class="module-panel"></div>
            <div id="module-item-analysis" class="module-panel"></div>
        </main>
    </div>

    <div id="subject-config-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>配置各科满分/及格线/优秀线</h3>
                <span id="modal-close-btn" class="modal-close-btn">&times;</span>
            </div>
            <div class="modal-body">
                <p>默认值已设为“语数英150，其他100”。</p>
                <div class="table-container" style="max-height: 400px; overflow-y: auto;">
                    <table id="subject-config-table">
                        <thead>
                            <tr>
                                <th>科目</th>
                                <th>满分 (Full)</th>
                                <th>优秀线 (Excel)</th>
                                <th>良好线 (Good)</th>
                                <th>及格线 (Pass)</th>
                            </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button id="modal-save-btn" class="sidebar-button">保存并重新分析</button>
            </div>
        </div>
    </div>

    <div id="import-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="import-modal-title">选择数据源</h3>
                <span id="import-modal-close-btn" class="modal-close-btn">&times;</span>
            </div>
            <div class="modal-body">
                <h4>1. 从“多次考试分析”模块导入</h4>
                <p>选择一个您在“模块十二”中已保存的成绩单。</p>
                <select id="import-modal-select" class="sidebar-select" style="width: 100%;"></select>
                <button id="import-modal-from-storage" class="sidebar-button" style="width: 100%; margin-top: 10px;">
                    导入选中项
                </button>
                <hr style="margin: 20px 0;">
                <h4>2. 从本地文件导入</h4>
                <p>像以前一样，从您的电脑上传一个新文件。</p>
                <button id="import-modal-from-file" class="sidebar-button"
                    style="width: 100%; background-color: var(--color-gray);">
                    从本地文件上传
                </button>
            </div>
        </div>
    </div>

    <div id="item-analysis-config-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3 id="item-config-modal-title">配置题目详情 (科目: -)</h3>
                <span id="item-config-modal-close-btn" class="modal-close-btn">&times;</span>
            </div>
            <div class="modal-body">
                <p>
                    “满分”：留空则使用自动检测的满分 (见灰色提示文字)。手动填写数字将覆盖自动检测，并用于重新计算得分率。
                    <br>
                    “考察内容”：填写本题的知识点，方便后续分析。
                </p>
                <div class="table-container" style="max-height: 50vh; overflow-y: auto;">
                    <table id="item-config-table">
                        <thead>
                            <tr>
                                <th>题号 (类型)</th>
                                <th>满分 (留空=自动)</th>
                                <th>考察内容 (知识点)</th>
                            </tr>
                        </thead>
                        <tbody id="item-config-table-body">
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button id="item-config-modal-save-btn" class="sidebar-button">保存并重新分析</button>
            </div>
        </div>
    </div>


    <div id="print-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3>选择打印范围</h3>
                <span id="print-modal-close-btn" class="modal-close-btn">&times;</span>
            </div>
            <div class="modal-body">
                <p>请选择您要打印的学生范围。这可能需要几秒钟时间来生成所有报告。</p>

                <button id="print-btn-current" class="sidebar-button" style="width: 100%; margin-top: 10px;" disabled>
                    🖨️ 打印当前学生 (未选择)
                </button>

                <button id="print-btn-filter" class="sidebar-button"
                    style="width: 100%; margin-top: 10px; background-color: var(--color-green);">
                    🖨️ 打印当前筛选 (全体年段)
                </button>

                <p style="color: var(--text-muted); font-size: 0.9em; margin-top: 15px;">
                    “打印当前筛选”会打印您在左侧边栏选择的班级（例如 "高一(1)班" 或 "全体年段"）。
                </p>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>

</html>